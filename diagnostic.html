<!DOCTYPE html>
<html lang="ru">
<head>
  <meta charset="utf-8">
  <title>VoxImplant –î–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–∞</title>
  <script src="https://cdn.voximplant.com/voximplant.min.js"></script>
  <style>
    body {
      font-family: monospace;
      max-width: 1000px;
      margin: 20px auto;
      padding: 20px;
      background: #1e1e1e;
      color: #d4d4d4;
    }
    .log {
      background: #2d2d2d;
      padding: 10px;
      margin: 5px 0;
      border-radius: 3px;
      border-left: 3px solid #4CAF50;
    }
    .error {
      border-left-color: #f44336;
      color: #ff6b6b;
    }
    .warn {
      border-left-color: #ff9800;
      color: #ffa726;
    }
    button {
      background: #4CAF50;
      color: white;
      border: none;
      padding: 10px 20px;
      margin: 5px;
      cursor: pointer;
      border-radius: 3px;
    }
    button:disabled {
      background: #555;
    }
    h2 {
      color: #4CAF50;
      margin-top: 20px;
    }
    input {
      background: #2d2d2d;
      color: white;
      border: 1px solid #555;
      padding: 5px 10px;
      margin: 5px;
      border-radius: 3px;
      width: 300px;
    }
  </style>
</head>
<body>
  <h1>VoxImplant WebRTC –î–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–∞</h1>
  
  <div>
    <h2>–ù–∞—Å—Ç—Ä–æ–π–∫–∏ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è</h2>
    <input id="login" placeholder="–õ–æ–≥–∏–Ω" value="0809@gircychatnj.n9.voximplant.com">
    <input id="password" type="password" placeholder="–ü–∞—Ä–æ–ª—å" value="Uzolon.8585">
    <br>
    <button id="startTest">–ù–∞—á–∞—Ç—å —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ</button>
    <button id="clearLog">–û—á–∏—Å—Ç–∏—Ç—å –ª–æ–≥</button>
  </div>
  
  <div id="logs"></div>

<script>
const logsDiv = document.getElementById('logs');
const startBtn = document.getElementById('startTest');
const clearBtn = document.getElementById('clearLog');
const loginInput = document.getElementById('login');
const passwordInput = document.getElementById('password');

let vox = null;

function log(message, type = 'log') {
  const div = document.createElement('div');
  div.className = `log ${type}`;
  const time = new Date().toLocaleTimeString();
  div.textContent = `[${time}] ${message}`;
  logsDiv.appendChild(div);
  logsDiv.scrollTop = logsDiv.scrollHeight;
  console.log(message);
}

clearBtn.onclick = () => {
  logsDiv.innerHTML = '';
};

startBtn.onclick = async () => {
  startBtn.disabled = true;
  logsDiv.innerHTML = '';
  
  try {
    // 1. –ü—Ä–æ–≤–µ—Ä–∫–∞ SDK
    log('=== –ù–ê–ß–ê–õ–û –î–ò–ê–ì–ù–û–°–¢–ò–ö–ò ===');
    log(`VoxImplant SDK –≤–µ—Ä—Å–∏—è: ${VoxImplant.version || '–Ω–µ–∏–∑–≤–µ—Å—Ç–Ω–∞'}`);
    
    // 2. –ü–æ–ª—É—á–µ–Ω–∏–µ —ç–∫–∑–µ–º–ø–ª—è—Ä–∞
    vox = VoxImplant.getInstance();
    log('–≠–∫–∑–µ–º–ø–ª—è—Ä VoxImplant –ø–æ–ª—É—á–µ–Ω');
    
    // 3. –ü—Ä–æ–≤–µ—Ä–∫–∞ –ø–æ–¥–¥–µ—Ä–∂–∫–∏ WebRTC
    if (vox.isRTCsupported && typeof vox.isRTCsupported === 'function') {
      const rtcSupported = vox.isRTCsupported();
      log(`WebRTC –ø–æ–¥–¥–µ—Ä–∂–∫–∞: ${rtcSupported ? '–î–ê' : '–ù–ï–¢'}`);
    }
    
    // 4. –ù–∞—Å—Ç—Ä–æ–π–∫–∞ –≤—Å–µ—Ö –æ–±—Ä–∞–±–æ—Ç—á–∏–∫–æ–≤ —Å–æ–±—ã—Ç–∏–π
    log('\n=== –ù–ê–°–¢–†–û–ô–ö–ê –û–ë–†–ê–ë–û–¢–ß–ò–ö–û–í –°–û–ë–´–¢–ò–ô ===');
    
    vox.addEventListener(VoxImplant.Events.SDKReady, (e) => {
      log('‚úÖ –°–æ–±—ã—Ç–∏–µ: SDKReady');
    });
    
    vox.addEventListener(VoxImplant.Events.ConnectionEstablished, (e) => {
      log('‚úÖ –°–æ–±—ã—Ç–∏–µ: ConnectionEstablished');
      log('–ù–∞—á–∏–Ω–∞–µ–º –ø—Ä–æ—Ü–µ—Å—Å –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏...');
      
      const login = loginInput.value;
      const password = passwordInput.value;
      
      log(`–ü—Ä–æ–±—É–µ–º –ª–æ–≥–∏–Ω: ${login}`);
      
      try {
        vox.login(login, password);
        log('–ú–µ—Ç–æ–¥ login –≤—ã–∑–≤–∞–Ω —É—Å–ø–µ—à–Ω–æ');
      } catch (err) {
        log(`‚ùå –û—à–∏–±–∫–∞ –ø—Ä–∏ –≤—ã–∑–æ–≤–µ login: ${err.message}`, 'error');
      }
    });
    
    vox.addEventListener(VoxImplant.Events.ConnectionFailed, (e) => {
      log(`‚ùå –°–æ–±—ã—Ç–∏–µ: ConnectionFailed - ${JSON.stringify(e)}`, 'error');
    });
    
    vox.addEventListener(VoxImplant.Events.ConnectionClosed, (e) => {
      log('‚ö†Ô∏è –°–æ–±—ã—Ç–∏–µ: ConnectionClosed', 'warn');
    });
    
    vox.addEventListener(VoxImplant.Events.AuthResult, (e) => {
      log(`\n=== –†–ï–ó–£–õ–¨–¢–ê–¢ –ê–í–¢–û–†–ò–ó–ê–¶–ò–ò ===`);
      log(`–£—Å–ø–µ—Ö: ${e.result}`);
      log(`–ö–æ–¥: ${e.code}`);
      log(`–ö–ª—é—á: ${e.key}`);
      log(`–ü–æ–ª–Ω—ã–π –æ–±—ä–µ–∫—Ç: ${JSON.stringify(e)}`);
      
      if (e.result) {
        log('‚úÖ –ê–í–¢–û–†–ò–ó–ê–¶–ò–Ø –£–°–ü–ï–®–ù–ê!', 'log');
        
        // –ü—Ä–æ–±—É–µ–º —Å–¥–µ–ª–∞—Ç—å —Ç–µ—Å—Ç–æ–≤—ã–π –∑–≤–æ–Ω–æ–∫
        log('\n–ü—Ä–æ–±—É–µ–º —Å–¥–µ–ª–∞—Ç—å —Ç–µ—Å—Ç–æ–≤—ã–π –∑–≤–æ–Ω–æ–∫...');
        try {
          const call = vox.call({video: false});
          log('‚úÖ –ú–µ—Ç–æ–¥ call –≤—ã–∑–≤–∞–Ω —É—Å–ø–µ—à–Ω–æ');
          
          call.addEventListener(VoxImplant.CallEvents.Connected, () => {
            log('‚úÖ –ó–≤–æ–Ω–æ–∫ –ø–æ–¥–∫–ª—é—á–µ–Ω!');
          });
          
          call.addEventListener(VoxImplant.CallEvents.Failed, (e) => {
            log(`‚ùå –ó–≤–æ–Ω–æ–∫ –Ω–µ —É–¥–∞–ª—Å—è: ${e.reason} (–∫–æ–¥: ${e.code})`, 'error');
          });
          
        } catch (err) {
          log(`‚ùå –û—à–∏–±–∫–∞ –ø—Ä–∏ –≤—ã–∑–æ–≤–µ call: ${err.message}`, 'error');
        }
        
      } else {
        log(`‚ùå –ê–í–¢–û–†–ò–ó–ê–¶–ò–Ø –ù–ï –£–î–ê–õ–ê–°–¨`, 'error');
        
        // –î–µ—Ç–∞–ª—å–Ω—ã–π –∞–Ω–∞–ª–∏–∑ –æ—à–∏–±–∫–∏
        switch(e.code) {
          case 401:
            log('–ü—Ä–∏—á–∏–Ω–∞: –ù–µ–≤–µ—Ä–Ω—ã–π –ø–∞—Ä–æ–ª—å', 'error');
            log('–†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏—è: –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ø–∞—Ä–æ–ª—å –≤ –ø–∞–Ω–µ–ª–∏ VoxImplant', 'warn');
            break;
          case 404:
            log('–ü—Ä–∏—á–∏–Ω–∞: –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –Ω–µ –Ω–∞–π–¥–µ–Ω', 'error');
            log('–†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏—è: –ü—Ä–æ–≤–µ—Ä—å—Ç–µ —Ñ–æ—Ä–º–∞—Ç –ª–æ–≥–∏–Ω–∞', 'warn');
            break;
          case 500:
            log('–ü—Ä–∏—á–∏–Ω–∞: –í–Ω—É—Ç—Ä–µ–Ω–Ω—è—è –æ—à–∏–±–∫–∞ —Å–µ—Ä–≤–µ—Ä–∞', 'error');
            log('–í–æ–∑–º–æ–∂–Ω—ã–µ –ø—Ä–∏—á–∏–Ω—ã:', 'warn');
            log('- –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –Ω–µ –∞–∫—Ç–∏–≤–µ–Ω', 'warn');
            log('- –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –Ω–µ –ø—Ä–∏–≤—è–∑–∞–Ω –∫ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—é webrtc', 'warn');
            log('- –ù–µ—Ç –ø—Ä–∞–≤ –Ω–∞ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ Web SDK', 'warn');
            log('- –ü—Ä–æ–±–ª–µ–º—ã —Å –±–∞–ª–∞–Ω—Å–æ–º –∞–∫–∫–∞—É–Ω—Ç–∞', 'warn');
            log('- –ü—Ä–æ–±–ª–µ–º—ã —Å –Ω–∞—Å—Ç—Ä–æ–π–∫–∞–º–∏ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è', 'warn');
            break;
          default:
            log(`–ù–µ–∏–∑–≤–µ—Å—Ç–Ω—ã–π –∫–æ–¥ –æ—à–∏–±–∫–∏: ${e.code}`, 'error');
        }
      }
    });
    
    // 5. –ü—Ä–æ–≤–µ—Ä–∫–∞ –¥—Ä—É–≥–∏—Ö —Å–æ–±—ã—Ç–∏–π
    vox.addEventListener(VoxImplant.Events.MicAccessGranted, () => {
      log('üé§ –î–æ—Å—Ç—É–ø –∫ –º–∏–∫—Ä–æ—Ñ–æ–Ω—É –ø–æ–ª—É—á–µ–Ω');
    });
    
    vox.addEventListener(VoxImplant.Events.MicAccessDenied, () => {
      log('‚ùå –î–æ—Å—Ç—É–ø –∫ –º–∏–∫—Ä–æ—Ñ–æ–Ω—É –∑–∞–ø—Ä–µ—â–µ–Ω', 'error');
    });
    
    // 6. –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è SDK
    log('\n=== –ò–ù–ò–¶–ò–ê–õ–ò–ó–ê–¶–ò–Ø SDK ===');
    await vox.init({
      micRequired: true,
      videoSupport: false,
      progressTone: true,
      localVideoContainerId: null
    });
    log('‚úÖ SDK –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä–æ–≤–∞–Ω');
    
    // 7. –ü–æ–¥–∫–ª—é—á–µ–Ω–∏–µ
    log('\n=== –ü–û–î–ö–õ–Æ–ß–ï–ù–ò–ï –ö VOXIMPLANT ===');
    log('–ü—Ä–æ—Ç–æ–∫–æ–ª: ' + window.location.protocol);
    
    await vox.connect(false);
    log('‚úÖ –ú–µ—Ç–æ–¥ connect –≤—ã–∑–≤–∞–Ω');
    
  } catch (error) {
    log(`‚ùå –ö–†–ò–¢–ò–ß–ï–°–ö–ê–Ø –û–®–ò–ë–ö–ê: ${error.message}`, 'error');
    log(`–°—Ç–µ–∫: ${error.stack}`, 'error');
  } finally {
    setTimeout(() => {
      startBtn.disabled = false;
    }, 3000);
  }
};

// –ì–ª–æ–±–∞–ª—å–Ω–∞—è –æ–±—Ä–∞–±–æ—Ç–∫–∞ –æ—à–∏–±–æ–∫
window.addEventListener('error', (e) => {
  log(`‚ùå –ì–ª–æ–±–∞–ª—å–Ω–∞—è –æ—à–∏–±–∫–∞: ${e.message}`, 'error');
});

// –ü–µ—Ä–µ—Ö–≤–∞—Ç –∫–æ–Ω—Å–æ–ª—å–Ω—ã—Ö –ª–æ–≥–æ–≤ VoxImplant
const originalLog = console.log;
console.log = function(...args) {
  originalLog.apply(console, args);
  const message = args.join(' ');
  if (message.includes('VI WebRTC') || message.includes('VoxImplant')) {
    log(`[VoxImplant] ${message}`, 'log');
  }
};
</script>
</body>
</html>