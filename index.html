<!DOCTYPE html>
<html lang="ru">
<head>
  <meta charset="utf-8">
  <title>VoxImplant WebRTC –¢–µ—Å—Ç</title>
  <script src="https://cdn.voximplant.com/voximplant.min.js"></script>
  <style>
    body {
      font-family: Arial, sans-serif;
      max-width: 600px;
      margin: 50px auto;
      padding: 20px;
      background: #f5f5f5;
    }
    .container {
      background: white;
      padding: 30px;
      border-radius: 10px;
      box-shadow: 0 2px 10px rgba(0,0,0,0.1);
    }
    h1 {
      color: #333;
      margin-bottom: 20px;
    }
    #call {
      background: #4CAF50;
      color: white;
      border: none;
      padding: 15px 30px;
      font-size: 16px;
      border-radius: 5px;
      cursor: pointer;
      transition: background 0.3s;
    }
    #call:hover:not(:disabled) {
      background: #45a049;
    }
    #call:disabled {
      background: #ccc;
      cursor: not-allowed;
    }
    #status {
      margin-top: 20px;
      padding: 15px;
      background: #f0f0f0;
      border-radius: 5px;
      color: #333;
      font-size: 14px;
    }
    .info {
      margin-top: 20px;
      padding: 15px;
      background: #e3f2fd;
      border-radius: 5px;
      font-size: 13px;
      color: #1976d2;
    }
    .error {
      background: #ffebee;
      color: #c62828;
    }
  </style>
</head>
<body>
  <div class="container">
    <h1>VoxImplant WebRTC –¢–µ—Å—Ç</h1>
    <button id="call" disabled>–ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è...</button>
    <div id="status"></div>
    <div class="info">
      <strong>–õ–æ–≥–∏–Ω:</strong> 0809@gircychatnj.n9.voximplant.com<br>
      <strong>–ü–∞—Ä–æ–ª—å:</strong> Uzolon.8585
    </div>
  </div>

<script>
// –ñ–¥–µ–º –∑–∞–≥—Ä—É–∑–∫–∏ –¥–æ–∫—É–º–µ–Ω—Ç–∞
window.addEventListener('DOMContentLoaded', async () => {
  // –ü—Ä–æ–≤–µ—Ä—è–µ–º, —á—Ç–æ VoxImplant –∑–∞–≥—Ä—É–∂–µ–Ω
  if (typeof VoxImplant === 'undefined') {
    console.error('VoxImplant SDK –Ω–µ –∑–∞–≥—Ä—É–∂–µ–Ω!');
    document.getElementById('status').textContent = '–û—à–∏–±–∫–∞: SDK –Ω–µ –∑–∞–≥—Ä—É–∂–µ–Ω';
    return;
  }
  
  console.log('VoxImplant SDK –≤–µ—Ä—Å–∏—è:', VoxImplant.version || '–Ω–µ–∏–∑–≤–µ—Å—Ç–Ω–∞');
  
  const vox = VoxImplant.getInstance();
  const callButton = document.getElementById('call');
  const statusDiv = document.getElementById('status');
  let currentCall = null;
  
  function updateStatus(text) {
    console.log(text);
    statusDiv.textContent = text;
  }
  
  // –ü—Ä–æ–≤–µ—Ä—è–µ–º –¥–æ—Å—Ç—É–ø–Ω—ã–µ –º–µ—Ç–æ–¥—ã
  console.log('–î–æ—Å—Ç—É–ø–Ω—ã–µ –º–µ—Ç–æ–¥—ã vox:', Object.getOwnPropertyNames(Object.getPrototypeOf(vox)));
  
  // –û–ø—Ä–µ–¥–µ–ª—è–µ–º –º–µ—Ç–æ–¥ –ø–æ–¥–ø–∏—Å–∫–∏ –Ω–∞ —Å–æ–±—ã—Ç–∏—è
  const addEvent = (target, eventName, handler) => {
    if (typeof target.on === 'function') {
      target.on(eventName, handler);
    } else if (typeof target.addEventListener === 'function') {
      target.addEventListener(eventName, handler);
    } else {
      console.error('–ù–µ –Ω–∞–π–¥–µ–Ω –º–µ—Ç–æ–¥ –ø–æ–¥–ø–∏—Å–∫–∏ –Ω–∞ —Å–æ–±—ã—Ç–∏—è –¥–ª—è', target);
    }
  };
  
  // –ù–∞—Å—Ç—Ä–æ–π–∫–∞ –æ–±—Ä–∞–±–æ—Ç—á–∏–∫–æ–≤ —Å–æ–±—ã—Ç–∏–π –î–û –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏–∏
  addEvent(vox, VoxImplant.Events.SDKReady, () => {
    updateStatus('SDK –≥–æ—Ç–æ–≤ –∫ —Ä–∞–±–æ—Ç–µ');
  });
  
  // –ü—Ä–æ—Å—Ç–∞—è –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è –¥–ª—è —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è
  const LOGIN_NAME = '0809@gircychatnj.n9.voximplant.com';
  const PASSWORD = 'Uzolon.8585';
  
  addEvent(vox, VoxImplant.Events.ConnectionEstablished, () => {
    updateStatus('–°–æ–µ–¥–∏–Ω–µ–Ω–∏–µ —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–æ, –≤—ã–ø–æ–ª–Ω—è–µ—Ç—Å—è –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏—è...');
    
    console.log(`–ü—Ä–æ–±—É–µ–º –ª–æ–≥–∏–Ω: ${LOGIN_NAME}`);
    updateStatus(`–ê–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏—è –∫–∞–∫ ${LOGIN_NAME}...`);
    
    try {
      vox.login(LOGIN_NAME, PASSWORD);
    } catch (err) {
      console.error('–û—à–∏–±–∫–∞ –ø—Ä–∏ –≤—ã–∑–æ–≤–µ login:', err);
      updateStatus('–û—à–∏–±–∫–∞ –ø—Ä–∏ –≤—ã–∑–æ–≤–µ –º–µ—Ç–æ–¥–∞ login: ' + err.message);
    }
  });
  
  addEvent(vox, VoxImplant.Events.ConnectionFailed, (e) => {
    updateStatus('–û—à–∏–±–∫–∞ —Å–æ–µ–¥–∏–Ω–µ–Ω–∏—è: ' + e.message);
    console.error('–û—à–∏–±–∫–∞ —Å–æ–µ–¥–∏–Ω–µ–Ω–∏—è:', e);
  });
  
  addEvent(vox, VoxImplant.Events.ConnectionClosed, () => {
    updateStatus('–°–æ–µ–¥–∏–Ω–µ–Ω–∏–µ –∑–∞–∫—Ä—ã—Ç–æ');
    callButton.disabled = true;
    callButton.textContent = '–°–æ–µ–¥–∏–Ω–µ–Ω–∏–µ –∑–∞–∫—Ä—ã—Ç–æ';
  });
  
  addEvent(vox, VoxImplant.Events.AuthResult, (e) => {
    if (e.result) {
      updateStatus('‚úÖ –ê–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏—è —É—Å–ø–µ—à–Ω–∞! –ì–æ—Ç–æ–≤ –∫ –∑–≤–æ–Ω–∫–∞–º.');
      callButton.textContent = '–ü–æ–∑–≤–æ–Ω–∏—Ç—å';
      callButton.disabled = false;
      
      // –ù–∞—Å—Ç—Ä–æ–π–∫–∞ –æ–±—Ä–∞–±–æ—Ç—á–∏–∫–∞ –∑–≤–æ–Ω–∫–∞
      callButton.onclick = () => {
        if (currentCall) {
          // –ó–∞–≤–µ—Ä—à–∏—Ç—å —Ç–µ–∫—É—â–∏–π –∑–≤–æ–Ω–æ–∫
          currentCall.hangup();
          currentCall = null;
          callButton.textContent = '–ü–æ–∑–≤–æ–Ω–∏—Ç—å';
          updateStatus('–ó–≤–æ–Ω–æ–∫ –∑–∞–≤–µ—Ä—à–µ–Ω');
        } else {
          // –ù–∞—á–∞—Ç—å –Ω–æ–≤—ã–π –∑–≤–æ–Ω–æ–∫
          updateStatus('üìû –ó–≤–æ–Ω—é...');
          currentCall = vox.call({video: false});
          
          addEvent(currentCall, VoxImplant.CallEvents.Connected, () => {
            updateStatus('‚úÖ –ó–≤–æ–Ω–æ–∫ –ø–æ–¥–∫–ª—é—á–µ–Ω');
            callButton.textContent = '–ó–∞–≤–µ—Ä—à–∏—Ç—å –∑–≤–æ–Ω–æ–∫';
          });
          
          addEvent(currentCall, VoxImplant.CallEvents.Disconnected, () => {
            updateStatus('üìµ –ó–≤–æ–Ω–æ–∫ –∑–∞–≤–µ—Ä—à–µ–Ω');
            callButton.textContent = '–ü–æ–∑–≤–æ–Ω–∏—Ç—å';
            currentCall = null;
          });
          
          addEvent(currentCall, VoxImplant.CallEvents.Failed, (e) => {
            updateStatus('‚ùå –û—à–∏–±–∫–∞ –∑–≤–æ–Ω–∫–∞: ' + e.reason);
            callButton.textContent = '–ü–æ–∑–≤–æ–Ω–∏—Ç—å';
            currentCall = null;
          });
        }
      };
    } else {
      console.error('AuthResult –æ—Ç—Ä–∏—Ü–∞—Ç–µ–ª—å–Ω—ã–π:', e);
      
      // –ö–æ–¥—ã –æ—à–∏–±–æ–∫:
      // 401 - –Ω–µ–≤–µ—Ä–Ω—ã–π –ø–∞—Ä–æ–ª—å
      // 404 - –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –Ω–µ –Ω–∞–π–¥–µ–Ω
      // 500 - –≤–Ω—É—Ç—Ä–µ–Ω–Ω—è—è –æ—à–∏–±–∫–∞ —Å–µ—Ä–≤–µ—Ä–∞
      // 701 - —Ç–æ–∫–µ–Ω –∏—Å—Ç–µ–∫
      let errorMessage = '';
      let recommendation = '';
      
      if (e.code === 404) {
        errorMessage = '‚ùå –û—à–∏–±–∫–∞ 404: –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –Ω–µ –Ω–∞–π–¥–µ–Ω';
        recommendation = '–ü—Ä–æ–≤–µ—Ä—å—Ç–µ –∏–º—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –≤ –ø–∞–Ω–µ–ª–∏ VoxImplant';
      } else if (e.code === 401) {
        errorMessage = '‚ùå –û—à–∏–±–∫–∞ 401: –ù–µ–≤–µ—Ä–Ω—ã–π –ø–∞—Ä–æ–ª—å';
        recommendation = '–ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ø–∞—Ä–æ–ª—å –≤ –ø–∞–Ω–µ–ª–∏ VoxImplant';
      } else if (e.code === 500) {
        errorMessage = '‚ùå –û—à–∏–±–∫–∞ 500: –í–Ω—É—Ç—Ä–µ–Ω–Ω—è—è –æ—à–∏–±–∫–∞ —Å–µ—Ä–≤–µ—Ä–∞ VoxImplant';
        recommendation = '–í–æ–∑–º–æ–∂–Ω—ã–µ –ø—Ä–∏—á–∏–Ω—ã:\n' +
          '1. –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –Ω–µ –∞–∫—Ç–∏–≤–µ–Ω\n' +
          '2. –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –Ω–µ –ø—Ä–∏–≤—è–∑–∞–Ω –∫ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—é\n' +
          '3. –ù–µ—Ç –ø—Ä–∞–≤ –Ω–∞ Web SDK –ª–æ–≥–∏–Ω\n' +
          '4. –ü—Ä–æ–±–ª–µ–º—ã —Å –Ω–∞—Å—Ç—Ä–æ–π–∫–∞–º–∏ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è\n\n' +
          '–ü—Ä–æ–≤–µ—Ä—å—Ç–µ –≤ –ø–∞–Ω–µ–ª–∏ VoxImplant:\n' +
          '- –°—Ç–∞—Ç—É—Å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è (–¥–æ–ª–∂–µ–Ω –±—ã—Ç—å Active)\n' +
          '- –ü—Ä–∏–≤—è–∑–∫—É –∫ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—é webrtc\n' +
          '- –ü—Ä–∞–≤–∞ –Ω–∞ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ Web SDK';
      } else {
        errorMessage = `‚ùå –û—à–∏–±–∫–∞ ${e.code}`;
        recommendation = '–ù–µ–∏–∑–≤–µ—Å—Ç–Ω–∞—è –æ—à–∏–±–∫–∞';
      }
      
      updateStatus(errorMessage);
      console.log(recommendation);
      
      // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º —Ä–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏ –≤ –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å–µ
      const recommendDiv = document.createElement('div');
      recommendDiv.style.cssText = 'margin-top: 10px; padding: 10px; background: #f0f0f0; border-radius: 5px; font-size: 12px; white-space: pre-wrap;';
      recommendDiv.textContent = recommendation;
      statusDiv.appendChild(recommendDiv);
    }
  });
  
  try {
    // 1. –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è SDK
    updateStatus('–ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è SDK...');
    await vox.init({micRequired: true});
    
    // 2. –ü–æ–¥–∫–ª—é—á–µ–Ω–∏–µ –∫ —Å–µ—Ä–≤–µ—Ä—É (–ë–ï–ó await –¥–ª—è –ª–æ–≥–∏–Ω–∞)
    updateStatus('–ü–æ–¥–∫–ª—é—á–µ–Ω–∏–µ –∫ VoxImplant...');
    await vox.connect();
    // –õ–æ–≥–∏–Ω –±—É–¥–µ—Ç –≤—ã–ø–æ–ª–Ω–µ–Ω –≤ –æ–±—Ä–∞–±–æ—Ç—á–∏–∫–µ ConnectionEstablished
    
  } catch (error) {
    updateStatus('–ö—Ä–∏—Ç–∏—á–µ—Å–∫–∞—è –æ—à–∏–±–∫–∞: ' + error.message);
    console.error('–û—à–∏–±–∫–∞ –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏–∏:', error);
  }
});
</script>
</body>
</html>
